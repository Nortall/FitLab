# Use Cases — Fitness Backend (FastAPI)

---

## 1. Аутентификация и Пользователь

### UC-01. Регистрация нового пользователя

**Акторы:** Незарегистрированный пользователь   
**Цель:** Создать новую учетную запись   
**Предусловия:** Email не зарегистрирован в системе 

**Основной сценарий:**
1. Пользователь отправляет email, имя и пароль.
2. Система валидирует данные (формат email, сложность пароля).
3. Создаётся запись пользователя в БД.
4. Система возвращает успешный ответ.

**Альтернативные сценарии:**
- **A1:** Email уже существует → ошибка `email_taken`.
- **A2:** Неверный формат email → ошибка валидации.
- **A3:** Слабый пароль → ошибка.
- **A4:** Ошибка при создании пользователя → 500.

**Критерии приемки:**
- Пользователь создаётся корректно.
- Данные сохраняются корректно.
- При необходимости — учётная запись требует активации.

---

### UC-02. Авторизация пользователя

**Акторы:** Пользователь    
**Цель:** Получить access и refresh токены    
**Предусловия:** Аккаунт существует

**Основной сценарий:**
1. Пользователь вводит email и пароль.
2. Система проверяет учетные данные.
3. Генерируются JWT токены.
4. Возвращает токены клиенту.

**Альтернативные сценарии:**
- **A1:** Неверный пароль → 401 Unauthorized.
- **A2:** Аккаунт отключён/не активирован → ошибка.
- **A3:** Лимит попыток входа превышен → временная блокировка.

**Критерии приемки:**
- Корректные данные → успешный вход.
- Неверные данные → ошибка.

---

### UC-03. Просмотр и обновление профиля

**Акторы:** Пользователь   
**Цель:** Получить или изменить данные профиля    
**Предусловия:** Пользователь авторизован

**Основной сценарий (обновление):**
1. Пользователь отправляет новые значения (рост, вес и т.д.).
2. Система валидирует данные.
3. Обновляет запись.
4. Возвращает обновлённый профиль.

**Альтернативные сценарии:**
- **A1:** Неверные значения (рост = 0) → ошибка валидации.
- **A2:** Попытка изменить чужой профиль → 403.

**Критерии приемки:**
- Профиль корректно обновляется.
- Валидируется каждое поле.

---

## 2. Питание / Nutrition

### UC-04. Расчет суточных калорий (BMR/TDEE)

**Акторы:** Пользователь    
**Цель:** Получить BMR/TDEE рекомендации    
**Предусловия:** Пользователь ввел параметры  

**Основной сценарий:**
1. Пользователь отправляет возраст, пол, рост, вес, активность.
2. Система вычисляет BMR (формула Mifflin-St Jeor).
3. Система вычисляет TDEE.
4. Возвращает результаты и рекомендуемые калории.

**Альтернативные сценарии:**
- **A1:** Неверные значения → ошибка.

**Критерии приемки:**
- Формулы применяются корректно.
- Система возвращает детальную структуру (BMR, TDEE).

---

### UC-05. Сохранение расчётов питания

**Акторы:** Пользователь    
**Цель:** Сохранить результат расчётов в историю    
**Предусловия:** Расчёт выполнен

**Основной сценарий:**
1. Пользователь отправляет BMR/TDEE.
2. Система сохраняет запись в историю.
3. Возвращает подтверждение.

**Альтернативные сценарии:**
- **A1:** Пользователь передаёт поддельные данные → валидация/403.

**Критерии приемки:**
- Данные сохраняются корректно.
- Возможно получение истории.

---

### UC-06. Получение генерации дневного рациона

**Акторы:** Пользователь    
**Цель:** Получить пример меню на день    
**Предусловия:** Есть рассчитанный TDEE

**Основной сценарий:**
1. Пользователь запрашивает пример рациона.
2. Система подбирает набор блюд по калориям и макросам.
3. Возвращает итоговый рацион.

**Альтернативные сценарии:**
- **A1:** Нет сохранённых расчётов → 404 / рекомендация сначала выполнить расчёт.

**Критерии приемки:**
- Рацион соответствует TDEE ± допустимая погрешность.

---

### UC-07. Проверка пользовательского плана питания

**Акторы:** Пользователь   
**Цель:** Проверить, соответствует ли план нормам питания   
**Предусловия:** Пользователь предоставил список блюд

**Основной сценарий:**
1. Пользователь загружает список блюд с калориями.
2. Система считает общие калории/белки/жиры/углеводы.
3. Сравнивает с дневными нормами пользователя.
4. Возвращает отчёт: нарушения, дефицит, избыток.

**Альтернативные сценарии:**
- **A1:** Некорректный формат данных → ошибка валидации.
- **A2:** Не хватает данных для расчёта → предложить ввести недостающие параметры.

**Критерии приемки:**
- Анализ проводится корректно.
- Отчёт содержит понятные рекомендации.

---

### UC-08. Персональный недельный план питания

**Акторы:** Пользователь    
**Цель:** Сгенерировать персональную неделю питания    
**Предусловия:** Известны цели и предпочтения пользователя  

**Основной сценарий:**
1. Пользователь указывает предпочтения (вегетарианство, аллергии и т.д.).
2. Система подбирает блюда на 7 дней.
3. Учитывает цели, калорийность и ограничения.
4. Возвращает план + список покупок.

**Альтернативные сценарии:**
- **A1:** Недостаточно блюд в базе для всех дней → использовать повторения.

**Критерии приемки:**
- План соответствует всем требованиям.
- Список покупок полный и структурированный.

---

## 3. Тренировки / Workouts

### UC-09. Создание тренировки

**Акторы:** Пользователь    
**Цель:** Создать тренировку с упражнениями    
**Предусловия:** Пользователь авторизован

**Основной сценарий:**
1. Пользователь указывает название, длительность, список упражнений.
2. Система валидирует структуру.
3. Создаёт запись тренировки.
4. Возвращает данные.

**Альтернативные сценарии:**
- **A1:** Неверная структура списка упражнений → ошибка.
- **A2:** Пользователь превышает лимит (например, > 300 тренировок) → ошибка.

**Критерии приемки:**
- Тренировка создаётся полностью и корректно.

---

### UC-10. Анализ тренировочной активности

**Акторы:** Пользователь   
**Цель:** Получить рекомендации по тренировкам   
**Предусловия:** Есть история тренировок за период   

**Основной сценарий:**
1. Пользователь запрашивает анализ за неделю/месяц.
2. Система смотрит частоту, длительность, калории.
3. Анализирует распределение нагрузок.
4. Генерирует рекомендации (увеличить интенсивность, добавить отдых и т.д.).

**Альтернативные сценарии:**
- **A1:** Недостаточно данных для анализа → сообщение "соберите больше данных".

**Критерии приемки:**
- Анализ проводится на основе реальных данных.
- Рекомендации конкретные и обоснованные.

---

### UC-11. Получение списка тренировок

**Акторы:** Пользователь   
**Цель:** Просмотреть тренировки   
**Предусловия:** Пользователь авторизован  

**Основной сценарий:**
1. Пользователь указывает page, limit.
2. Система возвращает список тренировок с пагинацией.

**Альтернативные сценарии:**
- **A1:** Некорректный page/limit → ошибка.

**Критерии приемки:**
- Пагинация работает корректно.

---

### UC-12. Использование шаблонов тренировок

**Акторы:** Пользователь    
**Цель:** Быстро выбрать готовый тренировочный план   

**Основной сценарий:**
1. Пользователь запрашивает шаблоны.
2. Система возвращает встроенный набор.
3. Пользователь может на основе шаблона создать свою тренировку.

**Альтернативные сценарии:**
- **A1:** Шаблоны недоступны (ошибка загрузки) → 500.

**Критерии приемки:**
- Шаблоны отображаются корректно.

---

## 4. Прогресс и статистика

### UC-13. Добавление записи веса

**Акторы:** Пользователь   
**Цель:** Зафиксировать свой текущий вес    
**Предусловия:** Авторизация

**Основной сценарий:**
1. Пользователь отправляет вес + дату.
2. Система валидирует значения.
3. Записывает прогресс.
4. Возвращает подтверждение.

**Альтернативные сценарии:**
- **A1:** Вес вне диапазона (например, <20 кг) → ошибка.

**Критерии приемки:**
- Данные сохраняются с датой.

---

### UC-14. Автоматический недельный отчёт

**Акторы:** Пользователь    
**Цель:** Получить полный анализ прогресса   
**Предусловия:** Есть данные за период  

**Основной сценарий:**
1. Пользователь запрашивает отчёт.
2. Система собирает данные: тренировки, питание, вес.
3. Строит графики, выявляет тенденции.
4. Генерирует PDF/JSON отчёт.

**Альтернативные сценарии:**
- **A1:** Недостаточно данных → частичный отчёт с рекомендацией добавить данные.

**Критерии приемки:**
- Отчёт содержит все ключевые метрики.
- Графики корректно отображают тенденции.

---

### UC-15. Анализ прогресса

**Акторы:** Пользователь   
**Цель:** Получить рекомендации на основе прогресса   
**Предусловия:** Есть история изменений веса и активности

**Основной сценарий:**
1. Система анализирует скорость изменений.
2. Сравнивает с целевыми показателями.
3. Определяет проблемы: медленно худеет, слишком быстро, не соблюдает нормы.
4. Генерирует конкретные рекомендации.

**Альтернативные сценарии:**
- **A1:** Прогресс соответствует плану → похвала и поддержка текущего курса.

**Критерии приемки:**
- Рекомендации основаны на данных.
- Учитываются индивидуальные особенности.

---

### UC-16. Прогноз веса

**Акторы:** Пользователь   
**Цель:** Узнать, как изменится вес при текущем режиме   
**Предусловия:** Есть история веса и калорий

**Основной сценарий:**
1. Пользователь имеет историю веса и калорий.
2. Система строит модель прогноза (линейная регрессия/другие методы).
3. Возвращает предполагаемый вес через 7/14/30 дней.
4. Показывает доверительный интервал.

**Альтернативные сценарии:**
- **A1:** Недостаточно данных для прогноза → требуется больше записей.

**Критерии приемки:**
- Прогноз математически обоснован.
- Учитывается погрешность.

---

### UC-17. Получение агрегированной статистики

**Акторы:** Пользователь   
**Цель:** Получить калории/время за период   
**Предусловия:** Заполнены тренировки

**Основной сценарий:**
1. Пользователь указывает период (например, 7d).
2. Система агрегирует данные (sum, avg).
3. Возвращает статистику.

**Альтернативные сценарии:**
- **A1:** За период нет данных → вернуть пустой результат.

**Критерии приемки:**
- Агрегаты считаются корректно.

---

## 5. Система целей (Goals)

### UC-18. Создание цели

**Акторы:** Пользователь   
**Цель:** Создать цель (например, «Сбросить 4 кг»)   
**Предусловия:** Авторизация

**Основной сценарий:**
1. Пользователь вводит цель, тип, дату дедлайна и начальные данные.
2. Система сохраняет цель.
3. Возвращает данные цели.

**Альтернативные сценарии:**
- **A1:** Дедлайн в прошлом → ошибка.
- **A2:** Пользователь создаёт слишком много целей → ошибка/лимит.

**Критерии приемки:**
- Цель отражается в списке целей.

---

### UC-19. Автоматическая проверка выполнения цели

**Акторы:** Система   
**Цель:** Узнать, выполнена ли цель   
**Предусловия:** Цель существует, есть данные за период 

**Основной сценарий:**
1. Система анализирует данные за период цели.
2. Сравнивает с целевыми показателями.
3. Определяет: выполнено, в процессе, провалено.
4. Сохраняет результат и уведомляет пользователя.

**Альтернативные сценарии:**
- **A1:** Недостаточно данных для проверки → отложить проверку.

**Критерии приемки:**
- Проверка происходит автоматически.
- Статус цели обновляется корректно.

---

### UC-20. Автоматическое обновление цели

**Акторы:** Система   
**Цель:** Обновлять прогресс цели при новых данных   
**Предусловия:** Цель активна

**Основной сценарий:**
1. Пользователь добавляет тренировку или вес.
2. Система определяет, связана ли цель с этим событием.
3. Автоматически обновляет прогресс цели.
4. Пересчитывает % выполнения.

**Альтернативные сценарии:**
- **A1:** Данные нерелевантны цели → игнорировать.

**Критерии приемки:**
- Прогресс обновляется в реальном времени.
- Процент выполнения актуален.

---

### UC-21. Серии успехов (Streaks)

**Акторы:** Пользователь   
**Цель:** Мотивация через streak system   
**Предусловия:** Есть дневные цели

**Основной сценарий:**
1. Система фиксирует дни, когда пользователь достиг дневных целей.
2. Высчитывает текущий streak.
3. Отображает прогресс и рекорды.
4. Награждает за достижения.

**Альтернативные сценарии:**
- **A1:** Streak прерван → обнуление и начало нового.

**Критерии приемки:**
- Подсчёт ведётся корректно.
- Система мотивирует пользователя.

---

### UC-22. Обновление прогресса цели

**Акторы:** Пользователь   
**Цель:** Продвинуться к цели   
**Предусловия:** Цель существует   

**Основной сценарий:**
1. Пользователь обновляет свой прогресс (например, текущий вес).
2. Система пересчитывает % выполнения.
3. Обновляет цель.

**Альтернативные сценарии:**
- **A1:** Прогресс выходит за рамки целей → ошибка.

**Критерии приемки:**
- Прогресс пересчитывается корректно.

---

### UC-23. Уведомление о приближении дедлайна цели (background)

**Акторы:** Пользователь  
**Цель:** Уведомить пользователя при приближении дедлайна

**Основной сценарий:**
1. Ежедневный scheduled job проверяет цели.
2. Если дедлайн < 3 дней — отправляет уведомление.
3. Логирует отправку.

**Альтернативные сценарии:**
- **A1:** Ошибка отправки email → запись в лог + повторная попытка.

**Критерии приемки:**
- Работает полностью асинхронно.
- Не дублирует уведомления.

---

## 6. Медиа / Uploads

### UC-24. Загрузка аватара

**Акторы:** Пользователь  
**Цель:** Загрузить фото   
**Предусловия:** Авторизация

**Основной сценарий:**
1. Пользователь вызывает `POST /media/upload`.
2. Система генерирует presigned URL.
3. Пользователь загружает файл напрямую в S3.
4. Система сохраняет метаданные в БД.
5. Возвращает URL.

**Альтернативные сценарии:**
- **A1:** Размер файла превышает лимит → ошибка.
- **A2:** Неверный MIME-тип → ошибка.

**Критерии приемки:**
- Файл доступен по URL.
- Метаданные корректны.

---

## 7. Администрирование

### UC-25. Просмотр списка пользователей

**Акторы:** Администратор  
**Цель:** Получить список пользователей   
**Предусловия:** Авторизация администратора

**Основной сценарий:**
1. Админ указывает фильтры (email, дата регистрации).
2. Система возвращает список.

**Альтернативные сценарии:**
- **A1:** Нет прав → 403.

**Критерии приемки:**
- Список фильтруется и пагинируется.

---

### UC-26. Управление шаблонами тренировок

**Акторы:** Администратор  
**Цель:** Создать/изменить шаблон тренировок

**Основной сценарий:**
1. Админ отправляет структуру шаблона.
2. Система валидирует.
3. Сохраняет.

**Альтернативные сценарии:**
- **A1:** Ошибка в структуре → валидатор.

**Критерии приемки:**
- Пользователи видят обновлённые шаблоны.

---

## 8. Сложная бизнес-логика

### UC-27. AI-рекомендации тренировок по истории данных

**Акторы:** Пользователь
**Цель:** Получить персональные тренировки на основе истории и прогресса

**Основной сценарий:**
1. Пользователь вызывает `GET /workouts/ai-suggest`.
2. Система анализирует историю тренировок, прогресс, активность.
3. Подбирает тренировку по модели правил/ML-алгоритма.
4. Возвращает рекомендации.

**Альтернативные сценарии:**
- **A1:** Недостаточно данных → возврат шаблонных советов.

**Критерии приемки:**
- Рекомендации релевантны профилю.

---

### UC-28. Автоматический пересчёт калорий при обновлении веса

**Акторы:** Пользователь   
**Цель:** Получить актуальные калории без ручного пересчёта   
**Предусловия:** Пользователь обновил вес

**Основной сценарий:**
1. Пользователь добавляет новую запись веса.
2. Система автоматически пересчитывает BMR/TDEE.
3. Обновляет результат.
4. Логирует изменения.
5. Уведомляет пользователя об изменениях.

**Альтернативные сценарии:**
- **A1:** Перепад веса слишком большой → предупреждение и запрос подтверждения.

**Критерии приемки:**
- Пересчёт запускается автоматически.
- Пользователь получает актуальные данные.

---

### UC-29. Детекция «плато» по весу

**Акторы:** Система    
**Цель:** Определить, когда прогресс остановился   
**Предусловия:** Есть история веса за 14+ дней

**Основной сценарий:**
1. Система анализирует 14 последних записей веса.
2. Если изменения < 0.2 кг → определяет плато.
3. Анализирует возможные причины (питание, тренировки).
4. Генерирует персонализированные рекомендации.
5. Уведомляет пользователя.

**Альтернативные сценарии:**
- **A1:** Недостаточно данных → функция отключена.

**Критерии приемки:**
- Алгоритм корректно определяет стагнацию.
- Рекомендации конкретные и полезные.

---

### UC-30. Автоматическое создание недельного плана тренировок

**Акторы:** Пользователь   
**Цель:** Получить тренировочный план на неделю   
**Предусловия:** Известны цели и уровень пользователя

**Основной сценарий:**
1. Пользователь запрашивает недельный план.
2. Система анализирует цели, доступное время, прошлые тренировки.
3. Генерирует сбалансированный план на 7 дней.
4. Учитывает восстановление и прогрессию нагрузки.
5. Сохраняет и возвращает план.

**Альтернативные сценарии:**
- **A1:** Недостаточно данных о целях → запрос дополнительной информации.
- **A2:** Противоречивые требования → предложение компромиссного варианта.

**Критерии приемки:**
- План соответствует цели и уровню активности.
- Нагрузка распределена оптимально.

---

### UC-31. Детекция перетренированности

**Акторы:** Система   
**Цель:** Определить риски слишком высокой нагрузки   
**Предусловия:** Есть история тренировок

**Основной сценарий:**
1. Система анализирует последние N тренировок.
2. Вычисляет суммарную нагрузку (объём × интенсивность).
3. Сравнивает с индивидуальными лимитами.
4. Если нагрузка > порога → генерирует предупреждение.
5. Предлагает скорректировать план.

**Альтернативные сценарии:**
- **A1:** Недостаточно данных → пропустить анализ.

**Критерии приемки:**
- Алгоритм корректно вычисляет нагрузку.
- Предупреждения своевременны.

---

### UC-32. Автоматический пересчёт калорий при изменении профиля

**Акторы:** Система   
**Цель:** Не требовать ручного пересчёта калорий   
**Предусловия:** Пользователь изменил профильные данные

**Основной сценарий:**
1. Пользователь обновляет вес/рост/уровень активности.
2. Система определяет, что эти поля влияют на калории.
3. Автоматически пересчитывает BMR/TDEE.
4. Сохраняет обновлённые данные.
5. Обновляет связанные планы питания.

**Альтернативные сценарии:**
- **A1:** Изменения незначительные → пропустить пересчёт.
- **A2:** Ошибка при пересчёте → уведомить пользователя.

**Критерии приемки:**
- Пересчёт происходит автоматически.
- Все зависимые данные обновляются.


